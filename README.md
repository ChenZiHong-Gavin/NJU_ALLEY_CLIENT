# 🌟加一个星星



:tanabata_tree:一些尝试的过程

1. 腾讯移动分析服务

   腾讯因为收益太少于2020年9月25日给它下架了。

2. 企业认证

   具有评论功能的小程序被微信官方认为是社交类的，所以需要注册企业版小程序。

   因此必须进行企业认证。

   有如下几个途径：

   - 自己注册公司：在南京地区注册一家公司大约要600元，自己办理手续繁琐。请人待办大约需要3-5个工作日。
   - 挂靠在他人的企业

3. 关闭云开发

   刚开始注册小程序的时候似乎默认进行云开发。

   云开发的好处是不用后端服务器。

   坏处是只能处理一些简单的函数，并且关闭它的设置十分难找。

4. 使用weapp组件，vant-ui

   有两种使用方式：

   1. 构建npm包：对熟悉npm操作的人比较友好
   2. 下载源码进行引用：简单粗暴

5. 学习flex布局

   没看完

6. 完成逻辑跳转和基本功能

   页面构成

   ```
   pages:
   
   ```

   基本功能：

   

   - 引导页

     设置一个白页，或者加载动画

     在这个页面的js文件里面将整个小程序的页面跳转方式记下来

   - 浏览地图

     选用合适的地图API

     需要满足条件：显示3D建筑

     微信小程序自带map组件

     只要使用

     ``` wxml
     <map id="map" longitude="113.324520" latitude="23.099994" scale="14"></map>
     ```

     微信小程序中的map组件默认使用腾讯地图。

     设置map全屏：

     ``` js
     //index.js
     var app = getApp()
     Page({
         data: {
             height: 'auto'
         },
         onLoad: function () {
             //保证wx.getSystemInfo的回调函数中能够使用this
             var that = this
      
             //调用wx.getSystemInfo接口，然后动态绑定组件高度
             wx.getSystemInfo({
                 success: function (res) {
                     that.setData({
                         height: res.windowHeight
                     })
                 }
             })
      
         }
     })
     ```

     - 腾讯地图微信小程序组件

       因为腾讯地图在微信开发者工具中的3D楼块显示效果不好，所以开始考虑其它方案。

     - 百度地图微信小程序组件

       百度地图似乎都没有3D建筑的功能

     - 高德地图微信小程序组件

       高德也没有

     - 使用ESMAP制作h5，在小程序中进行web-view跳转

       > web-view是承载网页的容器
       >
       > 会自动铺满整个小程序页面
       >
       > 个人类型的小程序暂不支持使用

       ESMAP不是完全免费，并且给小程序的api十分有限

       3D楼块的展示也不是很好看

     - 使用百度地图的JavaScript API

       JavaScript API无法直接用到小程序中，必须同ESMAP一样，首先建立一个h5页面，然后通过小程序的web-view进行交互。

       发现了web-view的一系列问题：

       1. 打开的域名没有在小程序管理后台设置业务域名（注意是业务域名，不是服务器域名） 
       2. 打开的页面必须为https服务
       3. 打开的页面302过去的地址也必须设置过业务域名
       4. web-view空白问题，请升级微信客户端到 6.5.16
       5. 页面可以包含iframe，但是iframe的地址必须为业务域名
       6. web-view不支持支付能力，web-view的API能力见web-view的文档说明
       7. 开发者自己检查自己的https服务是否正常，测试方法：普通浏览器打开对应的地址
       8. 如果web-view使用了公众号授权的服务，开发者工具提示网页开发者的问题，请见：公众号开发

       这玩意就跟微信小程序禁用svg一样，把本来简单的问题极端复杂化了。

       然而，就当没有办法的时候。

       突然发现腾讯地图的微信小程序组件中的3D模块在真机演示时候的效果惊人。

       于是满意地继续下去。

       - 头像悬浮

       - 修改微信原生标题栏

         变成全面屏 

         ``` json
         "navigationStyle": "custom"
         ```

         

       

       

     

     



还需要完成的工作：

1. 小程序命名

   需要等域名审核结果出来

   






8. 使用小程序内置的canvas渲染器，在cax中实现svg标准的子集

9. 获取用户发表的所有评论

   放在地图页面

